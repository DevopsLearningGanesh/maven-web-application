pipeline{
agent any

tools{
maven "Maven 3.8.6"
}

stages{

stage('GettingCodeFromGit'){
                           steps {
                                 notifyBuild("STARTED")
                                 git branch: 'development', url: 'https://github.com/DevopsLearningGanesh/maven-web-application.git'
                                 }
                           }
stage('Build'){
               steps {
                      sh "mvn clean package"
                      }
               }
stage('ExecuteSonarReport'){
                            steps {
                                   sh "mvn sonar:sonar"
                                  }
                            }
stage('NexusdeployArtifact'){
                            steps {
                                   sh "mvn deploy"
                                  }
                            }
stage('DeploytoTomcat'){
                            steps {
                                  sshagent(['d7b6dab7-6022-4a3c-9d44-e71758de1649']) {
                                                         sh "scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@13.233.50.27:/opt/apache-tomcat-9.0.68/webapps/"
                                                                 }
                                  }
                            }

}//stages end
post{
    success{
           notifyBuild(currentBuild.result)
           }

    failure{
           notifyBuild(currentBuild.result)
           }
     } 

}//pipeline end

def notifyBuild(String buildStatus = 'STARTED') {
  // build status of null means successful
  buildStatus =  buildStatus ?: 'SUCCESSFUL'

  // Default values
  def colorName = 'RED'
  def colorCode = '#FF0000'
  def subject = "${buildStatus}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'"
  def summary = "${subject} (${env.BUILD_URL})"

  // Override default values based on build status
  if (buildStatus == 'STARTED') {
    color = 'YELLOW'
    colorCode = '#FFFF00'
  } else if (buildStatus == 'SUCCESSFUL') {
    color = 'GREEN'
    colorCode = '#00FF00'
  } else {
    color = 'RED'
    colorCode = '#FF0000'
  }

  // Send notifications
  slackSend (color: colorCode, message: summary)
}




